function SpritePlayer(e){var t=void 0!==e.autoPlay&&e.autoPlay,n=e.canvas,i=void 0!==e.tarnsPng&&e.clearBeforeDraw,r=void 0!==e.drawClock?e.drawClock:0,a=void 0!==e.drawUnit?e.drawUnit:"repaint",o=void 0!==e.frameCount?e.frameCount:0,s=void 0!==e.frameHeight?e.frameHeight:0,l=void 0!==e.frameWidth?e.frameWidth:0,c=void 0!==e.imgSeqDel?e.imgSeqDel:"|",f=void 0!==e.imgSeqSrc?e.imgSeqSrc:"",u=void 0!==e.imgSrc?e.imgSrc:"",p=void 0!==e.loop&&e.loop,d=void 0!==e.spritesPerRow?e.spritesPerRow:o,m={},w=null,v=n.getContext("2d"),g=new Image,h=[],S="",T={},q=0,y=!1,C=function(){},F={config:e,currentFrame:0,currentTime:0};function k(){w=window.requestAnimationFrame(k),0===T.tick&&(C(),I()),T.tick+=1,T.tick>r&&(T.tick=0)}function E(e){w=window.requestAnimationFrame(E),T.fpsNow=e,T.fpsElapsed=T.fpsNow-T.fpsThen,T.fpsElapsed>T.fpsInterval&&(T.fpsThen=T.fpsNow-T.fpsElapsed%T.fpsInterval,C(),I())}function I(){q<o-1?q+=1:p?q=0:(window.cancelAnimationFrame(w),w=null,F.emit("spriteended"))}return F.play=function(){null===w&&function(e){if("sprite"==S)g.complete&&void 0!==g.naturalWidth&&0!=g.naturalWidth?e():(g.addEventListener("load",function(){e()}),g.src=u);else if("seqbase64"==S)if(0<h.length)e();else{var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(h=t.responseText.split(c),e()):console.error("Could not load "+f+" -  Status: "+t.status))},t.open("GET",f),t.send()}}(function(){F.emit("spriteplay"),"repaint"==a?(T.tick=0,k()):"fps"==a&&(T.fpsInterval=1e3/r,T.fpsThen=window.performance.now(),T.fpsStartTime=T.fpsThen,E())})},F.pause=function(){null!==w&&(window.cancelAnimationFrame(w),w=null,F.emit("spritepause"))},F.on=function(e,t){(m["$"+e]=m["$"+e]||[]).push(t)},F.off=function(e,t){if(0!=arguments.length){var n=m["$"+e];if(n)if(1!=arguments.length){for(var i,r=0;r<n.length;r++)if((i=n[r])===t||i.fn===t){n.splice(r,1);break}0===n.length&&delete m["$"+e]}else delete m["$"+e]}else m={}},F.emit=function(e){var t=[].slice.call(arguments,1),n=m["$"+e];if(t.unshift(e),n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(F,t)},F.setCurrentFrame=function(e){q=e,C(),I()},F.setCurrentTime=function(e){"repaint"!=a?(q=Math.floor(e*r),C(),I()):console.error("Cannot set current time with drawUnit: repaint")},u?(S="sprite",C=function(){i&&v.clearRect(0,0,l,s),v.drawImage(g,q%d*l,Math.floor(q/d)*s,l,s,0,0,l,s),"fps"==a&&(F.currentTime=q/r),F.currentFrame=q,F.emit("spritetimeupdate")}):f&&(S="seqbase64",C=function(){y||g.addEventListener("load",function(){i&&v.clearRect(0,0,l,s),v.drawImage(g,0,0),y=!0}),g.src=h[q],"fps"==a&&(F.currentTime=q/r),F.currentFrame=q,F.emit("spritetimeupdate")}),F.config=e,F.currentFrame=0,F.currentTime=0,t&&F.play(),F}