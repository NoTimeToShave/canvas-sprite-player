/*! Cavvas Sprite Player v - 1.0.1
 * Â© Phillip Dodson
 * Build time: 10-16-2018 19:36:41
 */
function SpritePlayer(e){var t=void 0!==e.autoPlay&&e.autoPlay,n=e.canvas,i=void 0!==e.clearBeforeDraw&&e.clearBeforeDraw,r=void 0!==e.drawClock?e.drawClock:0,a=void 0!==e.drawUnit?e.drawUnit:"repaint",o=void 0!==e.frameCount?e.frameCount:0,s=void 0!==e.frameHeight?e.frameHeight:0,l=void 0!==e.frameWidth?e.frameWidth:0,c=void 0!==e.imgSeqDel?e.imgSeqDel:"|",f=void 0!==e.imgSeqSrc?e.imgSeqSrc:"",u=void 0!==e.imgSrc?e.imgSrc:"",p=void 0!==e.loop&&e.loop,d=void 0!==e.spritesPerRow?e.spritesPerRow:o,m={},w={},h=n.getContext("2d"),v=0,g=null,S=new Image,T=[],q="",y=null,C=!1,F={config:e,currentFrame:0,currentTime:0};function k(){y=window.requestAnimationFrame(k),0===w.tick&&(g(),I()),w.tick+=1,w.tick>r&&(w.tick=0)}function E(e){y=window.requestAnimationFrame(E),w.fpsNow=e,w.fpsElapsed=w.fpsNow-w.fpsThen,w.fpsElapsed>w.fpsInterval&&(w.fpsThen=w.fpsNow-w.fpsElapsed%w.fpsInterval,g(),I())}function I(){v<o-1?v+=1:p?v=0:(window.cancelAnimationFrame(y),y=null,F.emit("spriteended"))}return F.play=function(){null===y&&function(e){if("sprite"==q)S.complete&&void 0!==S.naturalWidth&&0!=S.naturalWidth?e():(S.addEventListener("load",function(){e()}),S.src=u);else if("seqbase64"==q)if(0<T.length)e();else{var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(T=t.responseText.split(c),e()):console.error("Could not load "+f+" -  Status: "+t.status))},t.open("GET",f),t.send()}}(function(){F.emit("spriteplay"),"repaint"==a?(w.tick=0,k()):"fps"==a&&(w.fpsInterval=1e3/r,w.fpsThen=window.performance.now(),w.fpsStartTime=w.fpsThen,E())})},F.pause=function(){null!==y&&(window.cancelAnimationFrame(y),y=null,F.emit("spritepause"))},F.on=function(e,t){(m["$"+e]=m["$"+e]||[]).push(t)},F.off=function(e,t){if(0!=arguments.length){var n=m["$"+e];if(n)if(1!=arguments.length){for(var i,r=0;r<n.length;r++)if((i=n[r])===t||i.fn===t){n.splice(r,1);break}0===n.length&&delete m["$"+e]}else delete m["$"+e]}else m={}},F.emit=function(e){var t=[].slice.call(arguments,1),n=m["$"+e];if(t.unshift(e),n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(F,t)},F.setCurrentFrame=function(e){v=e,g(),I()},F.setCurrentTime=function(e){"repaint"!=a?(v=Math.floor(e*r),g(),I()):console.error("Cannot set current time with drawUnit: repaint")},u?(q="sprite",g=function(){i&&h.clearRect(0,0,l,s),h.drawImage(S,v%d*l,Math.floor(v/d)*s,l,s,0,0,l,s),"fps"==a&&(F.currentTime=v/r),F.currentFrame=v,F.emit("spritetimeupdate")}):f&&(q="seqbase64",g=function(){C||S.addEventListener("load",function(){i&&h.clearRect(0,0,l,s),h.drawImage(S,0,0),C=!0}),S.src=T[v],"fps"==a&&(F.currentTime=v/r),F.currentFrame=v,F.emit("spritetimeupdate")}),n.height=s,n.width=l,F.config=e,F.currentFrame=0,F.currentTime=0,t&&F.play(),F}
