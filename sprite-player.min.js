function SpritePlayer(e){var r,t=void 0!==e.autoPlay&&e.autoPlay,n=e.canvas,i=void 0!==e.drawClock?e.drawClock:0,a=void 0!==e.drawUnit?e.drawUnit:"repaint",o=void 0!==e.frameCount?e.frameCount:0,c=void 0!==e.frameHeight?e.frameHeight:0,f=void 0!==e.frameWidth?e.frameWidth:0,u=void 0!==e.imgSrc?e.imgSrc:"",m=void 0!==e.loop&&e.loop,s=void 0!==e.spritesPerRow?e.spritesPerRow:o,p={},d=n.getContext("2d"),l=new Image,v={},w={config:e,currentFrame:currentFrame=0,currentTime:0};function h(){r=window.requestAnimationFrame(h),0===v.tick&&(g(),T()),v.tick+=1,v.tick>i&&(v.tick=0)}function F(e){r=window.requestAnimationFrame(F),v.fpsNow=e,v.fpsElapsed=v.fpsNow-v.fpsThen,v.fpsElapsed>v.fpsInterval&&(v.fpsThen=v.fpsNow-v.fpsElapsed%v.fpsInterval,g(),T())}function g(){d.clearRect(0,0,f,c),d.drawImage(l,currentFrame%s*f,Math.floor(currentFrame/s)*c,f,c,0,0,f,c),"fps"==a&&(w.currentTime=w.currentFrame/i),w.currentFrame=currentFrame,w.emit("spritetimeupdate")}function T(){currentFrame<o-1?currentFrame+=1:m?currentFrame=0:(window.cancelAnimationFrame(r),r=void 0,w.emit("spriteended"))}return w.play=function(){var e;void 0===r&&(e=function(){w.emit("spriteplay"),"repaint"==a?(v.tick=0,h()):"fps"==a&&(v.fpsInterval=1e3/i,v.fpsThen=window.performance.now(),v.fpsStartTime=v.fpsThen,F())},l.complete&&void 0!==l.naturalWidth&&0!=l.naturalWidth?e():(l.addEventListener("load",function(){e()}),l.src=u))},w.pause=function(){void 0!==r&&(window.cancelAnimationFrame(r),r=void 0,w.emit("spritepause"))},w.on=function(e,r){(p["$"+e]=p["$"+e]||[]).push(r)},w.off=function(e,r){if(0!=arguments.length){var t=p["$"+e];if(t)if(1!=arguments.length){for(var n,i=0;i<t.length;i++)if((n=t[i])===r||n.fn===r){t.splice(i,1);break}0===t.length&&delete p["$"+e]}else delete p["$"+e]}else p={}},w.emit=function(e){var r=[].slice.call(arguments,1),t=p["$"+e];if(r.unshift(e),t)for(var n=0,i=(t=t.slice(0)).length;n<i;++n)t[n].apply(w,r)},w.setCurrentFrame=function(e){currentFrame=e,g(),T()},w.setCurrentTime=function(e){"repaint"!=a?(currentFrame=Math.floor(e*i),g(),T()):console.error("Cannot set current time with drawUnit: repaint")},w.config=e,w.currentFrame=0,w.currentTime=0,t&&w.play(),w}